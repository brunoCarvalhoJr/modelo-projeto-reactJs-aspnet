{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/paulo/Projetos/maps/frontend/src/pages/mapa/PageMap.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\nimport * as turf from '@turf/turf';\nimport qs from 'querystring';\nimport L from 'leaflet';\nimport { SERVER, GEO_SERVER, ESTILO_TALHAO, ESTILO_IMOVEL, CENTROIDE_MAPA, ZOOM_MAXIMO_MAPA, ZOOM_MINIMO_MAPA, ZOOM_INICIAL_MAPA, GEO_SERVER_GEO_JSON } from './Constants';\nimport SideBar, { MapPainel } from './components/sidebar';\nimport { MapContainer } from './components/container';\nimport { Context } from './Context';\nimport { ToolBar } from './components/tools/ToolBar';\nimport { Zoom } from './components/tools/Zoom';\nimport IconeFazenda from 'assets/markers/farm-2.png';\nimport './map.css';\nconst car = 'MG-3108008-AAEEAB404821459BB17C92EB0C235B5E';\n\nconst PageMapa = () => {\n  _s();\n\n  const mapRef = useRef(null);\n  const containerTopleft = useRef(null);\n  const containerTopRight = useRef(null);\n  const containerBottomLeft = useRef(null);\n  const containerBottomRight = useRef(null);\n  const [talhoes, setTalhoes] = useState([]);\n  const [initialized, setInitialized] = useState(false);\n  const [layers] = useState(new L.featureGroup());\n  const [layersEdit] = useState(new L.featureGroup());\n  const [sidebarOpen, setSideBarOpen] = useState(false);\n  const marcadorMapa = new L.icon({\n    iconUrl: IconeFazenda,\n    shadowAnchor: [20, 40],\n    shadowSize: [40, 40],\n    iconSize: [40, 40],\n    iconAnchor: [20, 40],\n    popupAnchor: [1, -25],\n    tooltipAnchor: [16, -25]\n  });\n\n  const onClickSideBar = () => {\n    setSideBarOpen(!sidebarOpen);\n  };\n\n  useEffect(() => {\n    const load = async () => {\n      if (initialized) return;\n      const googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {\n        maxZoom: 20,\n        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']\n      });\n      mapRef.current = L.map('map', {\n        zoomControl: false,\n        layers: [googleSat]\n      }).setView(CENTROIDE_MAPA, ZOOM_INICIAL_MAPA).setMaxZoom(ZOOM_MAXIMO_MAPA).setMinZoom(ZOOM_MINIMO_MAPA);\n      mapRef.current.addLayer(layersEdit);\n      topleft(mapRef.current);\n      topright(mapRef.current);\n      bottomleft(mapRef.current);\n      bottomright(mapRef.current);\n      bindEvents(mapRef.current);\n      addLayerEstado(mapRef.current);\n      await addLayerImovel(mapRef.current);\n      await addLayerTalhao();\n      setInitialized(true);\n    };\n\n    load();\n  }, []); // methods internal\n\n  const _addLayerWMS = (lmap, wmsOptions) => {\n    const layer = L.tileLayer.wms(GEO_SERVER, wmsOptions);\n    layers.layer = layer;\n    layers.addLayer(layer);\n    lmap.addLayer(layers);\n  };\n\n  const _addLayerGEOJsonLocalizacao = async (query, style, property) => {\n    const {\n      data\n    } = await axios.get(`${SERVER}/talhao`, {\n      params: { ...query\n      },\n      paramsSerializer: params => {\n        return qs.stringify(params);\n      }\n    });\n    var features = [];\n    data.forEach(element => {\n      features.push(element.theGeom);\n    }); //const { features } = data;\n\n    const geoJSON = L.geoJSON(features, {\n      style,\n      pointToLayer: (feature, latlng) => {\n        return L.marker(latlng, {\n          icon: marcadorMapa\n        });\n      }\n    });\n    const list = [];\n    geoJSON.eachLayer(layer => {\n      layer.bindTooltip(features[0].properties[property]);\n      layers.addLayer(layer);\n      list.push(layer);\n    });\n    setTalhoes(list);\n    return Promise.resolve({\n      layer: geoJSON,\n      features\n    });\n  };\n\n  const _addLayerGEOJsonImovel = async style => {\n    const {\n      data\n    } = await axios.get(`${SERVER}/fazenda`);\n    var features = [];\n    debugger;\n    features.push(data.theGeom);\n    const geoJSON = L.geoJSON(features, {\n      style\n    });\n    const list = [];\n    geoJSON.eachLayer(layer => {\n      layers.addLayer(layer);\n      list.push(layer);\n    });\n    return Promise.resolve({\n      layer: geoJSON,\n      features,\n      data\n    });\n  };\n\n  const _addLayerGEOJsonTalhao = async fazenda => {\n    const {\n      data\n    } = await axios.get(`${SERVER}/talhao/${fazenda}`);\n    var features = [];\n    data.forEach(talhao => {\n      features.push(talhao.theGeom);\n      const geoJSON = L.geoJSON(features, ESTILO_TALHAO);\n      const list = [];\n      geoJSON.eachLayer(layer => {\n        layers.addLayer(layer);\n        list.push(layer);\n      });\n    });\n  };\n\n  const _zoomLayer = (lmap, geometria, options = {}) => {\n    const zoom = options.maxZoom || 13;\n\n    if (geometria.getBounds) {\n      lmap.fitBounds(geometria.getBounds());\n    } else if (geometria.getLatLng) {\n      lmap.setView(geometria.getLatLng(), zoom);\n    } else if (geometria instanceof L.LatLng || geometria instanceof Array) {\n      lmap.setView(geometria, zoom);\n    }\n  };\n\n  const _addControl = (lmap, containerCurrent, position) => {\n    const container = L.control({\n      position: position\n    });\n\n    container.onAdd = function () {\n      var divContainer = L.DomUtil.create('div', `leaflet-control ${position}`);\n      return divContainer;\n    };\n\n    container.addTo(lmap);\n    containerCurrent.current = container;\n  }; // END: methods internal\n\n\n  const addLayerEstado = lmap => {\n    const wmsOptions = {\n      layers: 'agro:estado',\n      format: 'image/png',\n      transparent: true,\n      tiled: true\n    };\n\n    _addLayerWMS(lmap, wmsOptions);\n  };\n\n  const addLayerImovel = async lmap => {\n    const {\n      layer,\n      data\n    } = await _addLayerGEOJsonImovel(ESTILO_IMOVEL);\n    await _addLayerGEOJsonTalhao(data.id, ESTILO_IMOVEL);\n\n    _zoomLayer(lmap, layer);\n  };\n\n  const addLayerTalhao = async () => {\n    const queryTalhao = {\n      typeName: 'agro:talhao',\n      maxFeatures: 50,\n      outputFormat: 'application/json'\n    };\n    const {\n      layer\n    } = await _addLayerGEOJson(queryTalhao, ESTILO_TALHAO, 'nome');\n  };\n\n  const bindEvents = lmap => {\n    lmap.on(L.Draw.Event.CREATED, async ({\n      layer\n    }) => {\n      await addLayerEditing(layer);\n    });\n  };\n\n  const addLayerEditing = async layer => {\n    layer.on('edit', async ({\n      target\n    }) => {\n      await sendServer(target);\n    });\n    layersEdit.addLayer(layer);\n    await sendServer(layer);\n  };\n\n  const sendServer = async layer => {\n    const data = {\n      Nome: 'T000',\n      Numero: '2',\n      ImovelId: 786,\n      TheGeom: layer.toGeoJSON()\n    };\n    const talhao = await axios.post(`${SERVER}/talhao`, data); // const talhaoLayer = L.geoJSON(talhao);\n    //setTalhoes([...talhoes, talhaoLayer]);\n  };\n\n  const topleft = lmap => {\n    _addControl(lmap, containerTopleft, 'topleft');\n  };\n\n  const topright = lmap => {\n    _addControl(lmap, containerTopRight, 'topright');\n  };\n\n  const bottomleft = lmap => {\n    _addControl(lmap, containerBottomLeft, 'bottomleft');\n  };\n\n  const bottomright = lmap => {\n    _addControl(lmap, containerBottomRight, 'bottomright');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"viewMap\",\n    children: /*#__PURE__*/_jsxDEV(Context.Provider, {\n      value: {\n        map: mapRef.current,\n        layersEdit\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `painel ${sidebarOpen ? '' : 'collapsed'}`,\n        children: /*#__PURE__*/_jsxDEV(MapPainel, {\n          onClickItem: onClickSideBar,\n          talhoes: talhoes\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        children: [initialized && containerTopleft && /*#__PURE__*/_jsxDEV(MapContainer, {\n          container: containerTopleft,\n          children: /*#__PURE__*/_jsxDEV(SideBar, {\n            onClickItem: onClickSideBar\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 13\n        }, this), initialized && containerTopRight && /*#__PURE__*/_jsxDEV(MapContainer, {\n          container: containerTopRight,\n          children: [/*#__PURE__*/_jsxDEV(Zoom, {\n            initialValue: ZOOM_INICIAL_MAPA,\n            max: ZOOM_MAXIMO_MAPA,\n            min: ZOOM_MINIMO_MAPA\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ToolBar, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 13\n        }, this), initialized && containerBottomLeft && /*#__PURE__*/_jsxDEV(MapContainer, {\n          container: containerBottomLeft\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 13\n        }, this), initialized && containerBottomRight && /*#__PURE__*/_jsxDEV(MapContainer, {\n          container: containerBottomRight\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 255,\n    columnNumber: 5\n  }, this);\n};\n\n_s(PageMapa, \"d18Vb42ds6I4zxie2m8s8Lqq6Fg=\");\n\n_c = PageMapa;\nexport default PageMapa;\n\nvar _c;\n\n$RefreshReg$(_c, \"PageMapa\");","map":{"version":3,"sources":["/home/paulo/Projetos/maps/frontend/src/pages/mapa/PageMap.js"],"names":["React","useEffect","useRef","useState","axios","turf","qs","L","SERVER","GEO_SERVER","ESTILO_TALHAO","ESTILO_IMOVEL","CENTROIDE_MAPA","ZOOM_MAXIMO_MAPA","ZOOM_MINIMO_MAPA","ZOOM_INICIAL_MAPA","GEO_SERVER_GEO_JSON","SideBar","MapPainel","MapContainer","Context","ToolBar","Zoom","IconeFazenda","car","PageMapa","mapRef","containerTopleft","containerTopRight","containerBottomLeft","containerBottomRight","talhoes","setTalhoes","initialized","setInitialized","layers","featureGroup","layersEdit","sidebarOpen","setSideBarOpen","marcadorMapa","icon","iconUrl","shadowAnchor","shadowSize","iconSize","iconAnchor","popupAnchor","tooltipAnchor","onClickSideBar","load","googleSat","tileLayer","maxZoom","subdomains","current","map","zoomControl","setView","setMaxZoom","setMinZoom","addLayer","topleft","topright","bottomleft","bottomright","bindEvents","addLayerEstado","addLayerImovel","addLayerTalhao","_addLayerWMS","lmap","wmsOptions","layer","wms","_addLayerGEOJsonLocalizacao","query","style","property","data","get","params","paramsSerializer","stringify","features","forEach","element","push","theGeom","geoJSON","pointToLayer","feature","latlng","marker","list","eachLayer","bindTooltip","properties","Promise","resolve","_addLayerGEOJsonImovel","_addLayerGEOJsonTalhao","fazenda","talhao","_zoomLayer","geometria","options","zoom","getBounds","fitBounds","getLatLng","LatLng","Array","_addControl","containerCurrent","position","container","control","onAdd","divContainer","DomUtil","create","addTo","format","transparent","tiled","id","queryTalhao","typeName","maxFeatures","outputFormat","_addLayerGEOJson","on","Draw","Event","CREATED","addLayerEditing","target","sendServer","Nome","Numero","ImovelId","TheGeom","toGeoJSON","post"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\nimport * as turf from '@turf/turf';\nimport qs from 'querystring';\nimport L from 'leaflet';\nimport {\n  SERVER,\n  GEO_SERVER,\n  ESTILO_TALHAO,\n  ESTILO_IMOVEL,\n  CENTROIDE_MAPA,\n  ZOOM_MAXIMO_MAPA,\n  ZOOM_MINIMO_MAPA,\n  ZOOM_INICIAL_MAPA,\n  GEO_SERVER_GEO_JSON,\n} from './Constants';\nimport SideBar, { MapPainel } from './components/sidebar';\nimport { MapContainer } from './components/container';\nimport { Context } from './Context';\nimport { ToolBar } from './components/tools/ToolBar';\nimport { Zoom } from './components/tools/Zoom';\nimport IconeFazenda from 'assets/markers/farm-2.png';\n\nimport './map.css';\n\nconst car = 'MG-3108008-AAEEAB404821459BB17C92EB0C235B5E';\n\nconst PageMapa = () => {\n  const mapRef = useRef(null);\n  const containerTopleft = useRef(null);\n  const containerTopRight = useRef(null);\n  const containerBottomLeft = useRef(null);\n  const containerBottomRight = useRef(null);\n  const [talhoes, setTalhoes] = useState([]);\n  const [initialized, setInitialized] = useState(false);\n  const [layers] = useState(new L.featureGroup());\n  const [layersEdit] = useState(new L.featureGroup());\n  const [sidebarOpen, setSideBarOpen] = useState(false);\n\n  const marcadorMapa = new L.icon({\n    iconUrl: IconeFazenda,\n    shadowAnchor: [20, 40],\n    shadowSize: [40, 40],\n    iconSize: [40, 40],\n    iconAnchor: [20, 40],\n    popupAnchor: [1, -25],\n    tooltipAnchor: [16, -25],\n  });\n\n  const onClickSideBar = () => {\n    setSideBarOpen(!sidebarOpen);\n  };\n\n  useEffect(() => {\n    const load = async () => {\n      if (initialized) return;\n      const googleSat = L.tileLayer(\n        'http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',\n        {\n          maxZoom: 20,\n          subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],\n        },\n      );\n\n      mapRef.current = L.map('map', {\n        zoomControl: false,\n        layers: [googleSat],\n      })\n        .setView(CENTROIDE_MAPA, ZOOM_INICIAL_MAPA)\n        .setMaxZoom(ZOOM_MAXIMO_MAPA)\n        .setMinZoom(ZOOM_MINIMO_MAPA);\n\n      mapRef.current.addLayer(layersEdit);\n\n      topleft(mapRef.current);\n      topright(mapRef.current);\n      bottomleft(mapRef.current);\n      bottomright(mapRef.current);\n      bindEvents(mapRef.current);\n      addLayerEstado(mapRef.current);\n      await addLayerImovel(mapRef.current);\n      await addLayerTalhao();\n      setInitialized(true);\n    };\n    load();\n  }, []);\n\n  // methods internal\n  const _addLayerWMS = (lmap, wmsOptions) => {\n    const layer = L.tileLayer.wms(GEO_SERVER, wmsOptions);\n    layers.layer = layer;\n    layers.addLayer(layer);\n    lmap.addLayer(layers);\n  };\n\n  const _addLayerGEOJsonLocalizacao = async (query, style, property) => {\n    const { data } = await axios.get(`${SERVER}/talhao`, {\n      params: { ...query },\n      paramsSerializer: params => {\n        return qs.stringify(params);\n      },\n    });\n    var features = [];\n\n    data.forEach(element => {\n      features.push(element.theGeom);\n    });\n    //const { features } = data;\n    const geoJSON = L.geoJSON(features, {\n      style,\n      pointToLayer: (feature, latlng) => {\n        return L.marker(latlng, { icon: marcadorMapa });\n      },\n    });\n\n    const list = [];\n    geoJSON.eachLayer(layer => {\n      layer.bindTooltip(features[0].properties[property]);\n      layers.addLayer(layer);\n      list.push(layer);\n    });\n    setTalhoes(list);\n    return Promise.resolve({ layer: geoJSON, features });\n  };\n\n  const _addLayerGEOJsonImovel = async style => {\n    const { data } = await axios.get(`${SERVER}/fazenda`);\n    var features = [];\n\n    debugger;\n    features.push(data.theGeom);\n    const geoJSON = L.geoJSON(features, { style });\n\n    const list = [];\n    geoJSON.eachLayer(layer => {\n      layers.addLayer(layer);\n      list.push(layer);\n    });\n    return Promise.resolve({ layer: geoJSON, features, data });\n  };\n\n  const _addLayerGEOJsonTalhao = async (fazenda) => {\n    const { data } = await axios.get(`${SERVER}/talhao/${fazenda}`);\n    var features = [];\n\n    data.forEach(talhao => {\n      features.push(talhao.theGeom);\n      const geoJSON = L.geoJSON(features, ESTILO_TALHAO);\n\n      const list = [];\n      geoJSON.eachLayer(layer => {\n        layers.addLayer(layer);\n        list.push(layer);\n      });\n    });\n  };\n\n  const _zoomLayer = (lmap, geometria, options = {}) => {\n    const zoom = options.maxZoom || 13;\n    if (geometria.getBounds) {\n      lmap.fitBounds(geometria.getBounds());\n    } else if (geometria.getLatLng) {\n      lmap.setView(geometria.getLatLng(), zoom);\n    } else if (geometria instanceof L.LatLng || geometria instanceof Array) {\n      lmap.setView(geometria, zoom);\n    }\n  };\n\n  const _addControl = (lmap, containerCurrent, position) => {\n    const container = L.control({\n      position: position,\n    });\n\n    container.onAdd = function () {\n      var divContainer = L.DomUtil.create('div', `leaflet-control ${position}`);\n      return divContainer;\n    };\n    container.addTo(lmap);\n    containerCurrent.current = container;\n  };\n  // END: methods internal\n\n  const addLayerEstado = lmap => {\n    const wmsOptions = {\n      layers: 'agro:estado',\n      format: 'image/png',\n      transparent: true,\n      tiled: true,\n    };\n    _addLayerWMS(lmap, wmsOptions);\n  };\n\n  const addLayerImovel = async lmap => {\n    const { layer, data } = await _addLayerGEOJsonImovel(ESTILO_IMOVEL);\n    await _addLayerGEOJsonTalhao(data.id, ESTILO_IMOVEL);\n    _zoomLayer(lmap, layer);\n  };\n\n  const addLayerTalhao = async () => {\n    const queryTalhao = {\n      typeName: 'agro:talhao',\n      maxFeatures: 50,\n      outputFormat: 'application/json',\n    };\n    const { layer } = await _addLayerGEOJson(\n      queryTalhao,\n      ESTILO_TALHAO,\n      'nome',\n    );\n  };\n\n  const bindEvents = lmap => {\n    lmap.on(L.Draw.Event.CREATED, async ({ layer }) => {\n      await addLayerEditing(layer);\n    });\n  };\n\n  const addLayerEditing = async layer => {\n    layer.on('edit', async ({ target }) => {\n      await sendServer(target);\n    });\n    layersEdit.addLayer(layer);\n    await sendServer(layer);\n  };\n\n  const sendServer = async layer => {\n    const data = {\n      Nome: 'T000',\n      Numero: '2',\n      ImovelId: 786,\n      TheGeom: layer.toGeoJSON(),\n    };\n    const talhao = await axios.post(`${SERVER}/talhao`, data);\n    // const talhaoLayer = L.geoJSON(talhao);\n    //setTalhoes([...talhoes, talhaoLayer]);\n  };\n\n  const topleft = lmap => {\n    _addControl(lmap, containerTopleft, 'topleft');\n  };\n\n  const topright = lmap => {\n    _addControl(lmap, containerTopRight, 'topright');\n  };\n\n  const bottomleft = lmap => {\n    _addControl(lmap, containerBottomLeft, 'bottomleft');\n  };\n\n  const bottomright = lmap => {\n    _addControl(lmap, containerBottomRight, 'bottomright');\n  };\n\n  return (\n    <div className=\"viewMap\">\n      <Context.Provider\n        value={{\n          map: mapRef.current,\n          layersEdit,\n        }}\n      >\n        <div className={`painel ${sidebarOpen ? '' : 'collapsed'}`}>\n          <MapPainel onClickItem={onClickSideBar} talhoes={talhoes} />\n        </div>\n        <div id=\"map\">\n          {initialized && containerTopleft && (\n            <MapContainer container={containerTopleft}>\n              <SideBar onClickItem={onClickSideBar} />\n            </MapContainer>\n          )}\n          {initialized && containerTopRight && (\n            <MapContainer container={containerTopRight}>\n              <Zoom\n                initialValue={ZOOM_INICIAL_MAPA}\n                max={ZOOM_MAXIMO_MAPA}\n                min={ZOOM_MINIMO_MAPA}\n              />\n              <ToolBar />\n            </MapContainer>\n          )}\n          {initialized && containerBottomLeft && (\n            <MapContainer container={containerBottomLeft}></MapContainer>\n          )}\n          {initialized && containerBottomRight && (\n            <MapContainer container={containerBottomRight}></MapContainer>\n          )}\n        </div>\n      </Context.Provider>\n    </div>\n  );\n};\n\nexport default PageMapa;\n"]},"metadata":{},"sourceType":"module"}